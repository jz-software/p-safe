<!DOCTYPE html>
<html lang="en">
    <head>
        <title>P-Safe</title>
        <link rel="stylesheet" type="text/css" href="./mainWindow.css">
        <script src="https://kit.fontawesome.com/3849555537.js" crossorigin="anonymous"></script>
    </head>
    <body>

        <script>
            const electron = require('electron');
            const {ipcRenderer} = electron;
        </script>

        <!--Gets user information-->
        <script>
            ipcRenderer.send('user:info');

            ipcRenderer.on('user:infosent', function(e, info){
                const information = info;
                document.querySelector(".welcome h1").innerHTML = `Welcome, <span style="color: #7289da">${information}</span>`;
            })
        </script>

        <!-- Side navigation -->
        <div class="sidenav">
            <a><i class="fas fa-plus-circle" onclick="ipcRenderer.send('password:create');"></i></a>
            <a><i class="fas fa-user" onclick="ipcRenderer.send('user:create');"></i></a>
            <a><i class="fas fa-bookmark"></i></a>
            <a><i class="fas fa-sliders-h"></i></a>
        </div>

        <div class="main">
            <!--Welcome Message-->
            <div class="welcome">
                <h1>Welcome to <strong></strong> &#128075</h1>
            </div>
            
            <table cellspacing="0" cellpadding="10" class="passwords"></table>
        </div>

        <script>
            function myFunction(x) {
                var pass = document.querySelectorAll("#pass");
                if (pass[x].type === "password") {
                    pass[x].type = "text";
                } else {
                    pass[x].type = "password";
                }
            } 
        </script>
        <script>
            function deletePassword(i){
                const item = {
                    index: i
                }    
                ipcRenderer.send('password:delete', item);
            }
        </script>

        <script>
            const ul = document.querySelector('.passwords');
            ipcRenderer.on('password:update', function(e, decryptedDatabase){
                ul.innerHTML = "";
                for(let i=0; i<decryptedDatabase.length; i++){
                    const li = document.createElement('tr');
                    li.innerHTML = 
                    `
                    <td><img src="../../storage/icons/${decryptedDatabase[i].icon}" onerror="this.onerror=null; this.src='../../storage/icons/default.png'"></td>
                    <td>${decryptedDatabase[i].service}</td>
                    <td>${decryptedDatabase[i].login}</td>
                    <td><input type="password" value="${decryptedDatabase[i].password}" id="pass"><input type="checkbox" onclick="myFunction(${i})">Show</td>
                    <td><i class="fas fa-trash" onclick="deletePassword(${i})"></i></td>
                    `
                    ul.appendChild(li);
                }
            })

        </script>
        <script>
            ipcRenderer.send('password:update');
        </script>
    </body>
</html>
