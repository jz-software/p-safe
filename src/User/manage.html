<html>
    <head>
        <title>My Profile</title>
        <link rel="stylesheet" type="text/css" href="./manage.css">
        <link rel="stylesheet" type="text/css" href="../Sidenav/sidenav.css">
        <script src="https://kit.fontawesome.com/3849555537.js" crossorigin="anonymous"></script>
    </head>
    <body>
        <script>
            const electron = require('electron');
            const {ipcRenderer} = electron;
        </script>

        <div class="sidenav">
            <script src="../Sidenav/sidenav.js"></script>
        </div>
        <div class="main">
            <div class="main-info">
                <div class="first-info">
                    <img id="profile-pic" changed="false" onclick="ipcRenderer.send('password:choosePicture')" onerror="this.onerror=null; this.src='../../storage/icons/default.png'">
                    <div>
                        <h1 id="nickname"></h1>
                        <p onclick="ipcRenderer.send('password:choosePicture')">Change Profile Picture</p>
                    </div>    
                </div>    
                <div class="other-info">
                    <table cellspacing="0" cellpadding="10" class="passwords">
                        <tr>
                            <td class="aside"><label for="nickname">Nickname</label></td>
                            <td class="content"><input id="login" value="" spellcheck="false"></td>
                        </tr>
                        <tr>
                            <td class="aside"><label for="email">Email</label></td>
                            <td class="content"><input id="email" value="" spellcheck="false"></td>
                        </tr>
                        <tr>
                            <td class="aside"></td>
                            <td class="content"><button class="submit" onclick="saveUser()">SAVE</button></td>
                        </tr>
                    </table>
                </div>
                <br>
                <br>
            </div>  
        </div>

        <script>
            ipcRenderer.on('page:profile:info:send', function(e, user){
                document.querySelector('#login').value = user.user;
                document.querySelector('#email').value = user.email;
                document.querySelector('#profile-pic').setAttribute('src', `../../storage/icons/${user.picture}`);
                document.querySelector('#nickname').textContent = user.user;
            })
            ipcRenderer.send('page:profile:info');

            ipcRenderer.on('password:picture', function(e, path){
                ipcRenderer.send('page:cropper', path);
            })

            ipcRenderer.on('page:cropper:out', function(e, picPath){
                document.querySelector('#profile-pic').setAttribute('src', picPath);
                document.querySelector('#profile-pic').setAttribute('changed', 'true');
            });

            function saveUser(){
                const user = {
                    login: document.querySelector('#login').value,
                    email: document.querySelector('#email').value,
                    picture: {changed: document.querySelector('#profile-pic').getAttribute('changed'), 
                        path: document.querySelector('#profile-pic').getAttribute('src')}
                }
                ipcRenderer.send('page:profile:save', user);
            }
        </script>
    </body>
</html>