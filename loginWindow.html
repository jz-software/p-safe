<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Add Password</title>
        <link rel="stylesheet" type="text/css" href="loginWindow.css">
        <script src="https://kit.fontawesome.com/3849555537.js" crossorigin="anonymous"></script>
    </head>
    <body>
        <!--
        <form id="login">
            <input id="loginValue" type="text" placeholder="login...">
            <br>
            <input id="login_password" type="text" placeholder="password...">
            <br>
            <input type="submit">
        </form>
        <br><br>
        <form id="register">
            <input id="login" type="text" placeholder="login...">
            <br>
            <input id="password" type="text" placeholder="password...">
            <br>
            <input type="submit">
        </form> -->
        <div class="circles">
            <div>
                <i class="fas fa-user-circle"></i>
                <br><br>
                <input id="login" type="text" placeholder="user" spellcheck="false">
            </div>    
        </div>

        <script>
            const electron = require('electron');
            const {ipcRenderer} = electron;
            let data = [];
        </script>

        <script>
            // Get the input field
            var input = document.getElementById("login");

            ipcRenderer.on('user:valid', function(e){
                input.value = "";
                input.setAttribute('placeholder', 'password')
                input.style.borderBottom = "1px solid #1EB584";
            })
            ipcRenderer.on('user:wrong', function(e){
                data = [];
                input.value = "";
                input.setAttribute('placeholder', 'user not found');
                input.style.borderBottom = "1px solid red";
                input.style.animation = "shake 0.3s"
            })

            // Execute a function when the user releases a key on the keyboard
            input.addEventListener("keyup", function(event) {
            // Number 13 is the "Enter" key on the keyboard
            if (event.keyCode === 13) {
                // Cancel the default action, if needed
                event.preventDefault();
                // Trigger the button element with a click
                data.push(document.querySelector('#login').value);
                if(data.length>0){
                    const item = {
                        username: document.querySelector('#login').value
                    }
                    ipcRenderer.send('user:checkLogin', item);
                }
                if(data.length>1){
                    const item = {
                        login: data[0],
                        password: data[1]
                    }    
                    ipcRenderer.send('user:login', item);
                    data.pop();
                    input.setAttribute('placeholder', 'password')
                }
            }
            }); 
        </script>

        <script>
            ipcRenderer.on('user:login:wrong', function(e, decryptedDatabase){
                const input = document.querySelector('#login');
                input.setAttribute('placeholder', 'Try again')
                input.style.borderBottom = "1px solid red";
            })

        </script>

        <script>

            const form = document.querySelector('#login');
            form.addEventListener('submit', submitForm);

            function submitForm(e){
                e.preventDefault();
                const item = {
                    login: document.querySelector('#login #loginValue').value,
                    password: document.querySelector('#login #login_password').value
                }    
                ipcRenderer.send('user:login', item);
            }
        </script>

        
        <script>
            const form2 = document.querySelector('#register');
            form2.addEventListener('submit', submitForm);

            function submitForm(e){
                e.preventDefault();
                const item = {
                    login: document.querySelector('#register #login').value,
                    password: document.querySelector('#register #password').value
                }    
                ipcRenderer.send('user:register', item);
            }
        </script>
    </body>
</html>